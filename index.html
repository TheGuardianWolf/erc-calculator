<!--
Toyota ERC Unlocker
Copyright (C) 2025 TheGuardianWolf

This program is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of  MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with
this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toyota ERC Unlocker</title>
    <link rel="icon" href="favicon.png" type="image/png" />
    <!-- Include stable Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Include Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/fontawesome.min.css"
      integrity="sha512-v8QQ0YQ3H4K6Ic3PJkym91KoeNT5S3PnDKvqnwqFD1oiqIl653crGZplPdU5KKtHjO0QKcQ2aUlQZYjHczkmGw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/brands.min.css"
      integrity="sha512-58P9Hy7II0YeXLv+iFiLCv1rtLW47xmiRpC1oFafeKNShp8V5bKV/ciVtYqbk2YfxXQMt58DjNfkXFOn62xE+g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
      }

      /* Light Mode */
      .top-bar {
        background-color: #0056b3; /* Darker blue color */
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .github-badge {
        display: flex;
        align-items: center;
        background-color: #ffffff;
        border-radius: 50px;
        padding: 5px 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        text-decoration: none;
        color: black; /* Badge text is black */
        font-weight: bold;
      }
      .github-badge i {
        margin-right: 8px;
      }
      .github-badge:hover {
        background-color: #e9ecef; /* Slight hover effect */
      }
      .top-section,
      .bottom-section {
        background-color: #007bff; /* Bootstrap primary blue color */
        color: white;
        padding: 20px;
      }
      .middle-section {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f8f9fa; /* Bootstrap light gray color */
        padding: 20px;
      }
      .card {
        padding: 20px;
        width: 100%;
        max-width: 400px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      .unlock-code {
        font-size: 1.5rem;
        margin-top: 20px;
        color: #007bff; /* Focus color */
      }

      /* Dark Mode */
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #121212; /* Dark background for body */
          color: #e1e1e1; /* Light text color */
        }
        .top-bar {
          background-color: #0056b3; /* Keep original dark blue color */
        }
        .github-badge {
          background-color: #303030; /* Dark badge background */
          color: white; /* Badge text is white in dark mode */
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); /* Subtle shadow */
        }
        .github-badge:hover {
          background-color: #505050; /* Slight hover effect */
        }
        .top-section,
        .bottom-section {
          background-color: #1a73e8; /* Slightly muted blue for dark mode */
          color: white;
        }
        .middle-section {
          background-color: #181818; /* Dark gray middle section */
          color: white; /* Middle text is now white */
        }
        .card {
          background-color: #242424; /* Dark card background */
          border-color: #3a3a3a; /* Darker border for card */
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Subtle shadow */
        }
        .unlock-code {
          color: #4cafef; /* Bright focus color for unlock code */
        }
        label,
        #output p {
          /* Ensure labels and Unlock Code text are white */
          color: white;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Bar -->
    <div class="top-bar">
      <span>Toyota ERC Unlocker</span>
      <a
        href="https://github.com/TheGuardianWolf/erc-calculator/tree/js-port"
        class="github-badge"
        target="_blank"
      >
        <i class="fab fa-github"></i> View on GitHub
      </a>
    </div>

    <!-- Top Section -->
    <div class="top-section text-center">
      <h1>Toyota ERC Unlocker</h1>
      <p>Unlock your car head unit with ease!</p>
    </div>

    <!-- Middle Section -->
    <div class="middle-section">
      <div class="card">
        <label for="ercInput" class="form-label">Enter 16 digit ERC:</label>
        <input
          type="text"
          id="ercInput"
          class="form-control mb-3"
          placeholder="e.g., 0073846700738467"
          maxlength="16"
        />
        <button id="processButton" class="btn btn-primary w-100">Generate Unlock Code</button>
        <div id="output" class="mt-4">
          <p>Unlock Code:</p>
          <div class="unlock-code" id="encodedOutput">N/A</div>
        </div>
      </div>
    </div>

    <!-- Bottom Section -->
    <div class="bottom-section text-center">
      <p>This tool is licensed under GNU GPL. Full license text is available in GitHub.</p>
    </div>

    <!-- Include Bootstrap JS (optional, if required for advanced features) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Provided JavaScript functions
      const getFullBinary = (str, count) => {
        while (str.length < count) {
          str = '0' + str;
        }
        return str;
      };

      const getReverse = (x) => {
        let reverseSecondPart = 0;

        for (let i = 0; i < 32; i++) {
          let temp = (x >>> (31 - i)) & 1; // Use unsigned right shift (>>>)
          temp = temp << i;
          reverseSecondPart |= temp;
        }

        // Ensure the result is an unsigned 32-bit integer
        return reverseSecondPart >>> 0;
      };

      const btnEncodeClick = (ercInput) => {
        let outputEnc = '';
        const erc = ercInput.replace(/[-\s]/g, '').trim();
        if (erc.length !== 16) return null;

        const firstPart = parseInt(erc.substring(0, 8), 16);
        const secondPart = parseInt(erc.substring(8), 16);
        const reverseSecondPart = getReverse(secondPart);

        // Ensure XOR result is unsigned
        const xor = (firstPart ^ reverseSecondPart) >>> 0;

        // Ensure subtraction result is unsigned
        const result = (xor - 0xe010a11) >>> 0;

        console.log('Debug', firstPart, secondPart, reverseSecondPart, xor, result);

        outputEnc = getFullBinary(result.toString(16).toUpperCase(), 8);

        return outputEnc;
      };

      // Attach functionality to the button
      document.getElementById('processButton').addEventListener('click', () => {
        const ercInput = document.getElementById('ercInput').value;
        const encodedOutput = btnEncodeClick(ercInput);

        const textContent = encodedOutput ? encodedOutput : 'Invalid ERC';

        document.getElementById('encodedOutput').textContent = textContent;
      });
    </script>
  </body>
</html>
